"""
Custom Knowledge Base Service

This service provides a comprehensive knowledge base focused on:
- Multilingual language processing (21 Indian languages + English)
- Cultural and linguistic information
- Technical NLP knowledge
- General knowledge in Assamese, Bengali, Bodo, English, Gujarati, Hindi, Kannada, 
  Kashmiri, Maithili, Malayalam, Marathi, Meitei, Nepali, Odia, Punjabi, Sanskrit, 
  Santali, Sindhi, Tamil, Telugu, and Urdu
"""

from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
from typing import Dict, List, Optional, Any
import asyncio
import time
import logging
from enum import Enum

logger = logging.getLogger(__name__)

class QueryType(str, Enum):
    FACTUAL = "factual"
    CONVERSATIONAL = "conversational"
    EDUCATIONAL = "educational"
    CULTURAL = "cultural"
    TECHNICAL = "technical"

class KBRequest(BaseModel):
    text: str
    language: str
    user_id: Optional[str] = None
    session_id: Optional[str] = None
    generate_response: bool = True
    max_response_length: int = 256

class KBResponse(BaseModel):
    answer: str
    confidence: float
    sources: List[str]
    language: str
    query_type: str
    processing_time: float
    kb_answer: Optional[str] = None
    generated_response: Optional[str] = None
    metadata: Optional[Dict[str, Any]] = None

class KnowledgeBase:
    """Comprehensive knowledge base with multilingual support"""
    
    def __init__(self):
        self.knowledge = self._initialize_knowledge_base()
        self.stats = {
            "total_queries": 0,
            "cache_hits": 0,
            "cache_misses": 0,
            "errors": 0
        }
    
    def _initialize_knowledge_base(self) -> Dict[str, Dict[str, Any]]:
        """Initialize the knowledge base with comprehensive information"""
        
        return {
            # Geography and Capitals
            "geography": {
                "assamese": {
                    "ভাৰতৰ ৰাজধানী": "ভাৰতৰ ৰাজধানী নতুন দিল্লী। এইটো দেশৰ ৰাজনৈতিক কেন্দ্ৰ আৰু ইয়াত সংসদ ভৱন আৰু ৰাষ্ট্ৰপতি ভৱন অৱস্থিত।",
                    "ফ্ৰান্সৰ ৰাজধানী": "ফ্ৰান্সৰ ৰাজধানী পেৰিছ। এইটো চেইন নদীৰ পাৰত অৱস্থিত এখন সুন্দৰ চহৰ।",
                },
                "bengali": {
                    "ভারতের রাজধানী": "ভারতের রাজধানী নয়া দিল্লি। এটি দেশের রাজনৈতিক কেন্দ্র এবং এখানে সংসদ ভবন এবং রাষ্ট্রপতি ভবন অবস্থিত।",
                    "ফ্রান্সের রাজধানী": "ফ্রান্সের রাজধানী প্যারিস। এটি সেন নদীর তীরে অবস্থিত একটি সুন্দর শহর।",
                },
                "bodo": {
                    "भारतनि राजधानी": "भारतनि राजधानी नयु दिल्ली। बे देसनि राजनैतिक केन्द्र आरो बेयाव संसद भवन आरो राष्ट्रपति भवन दङ।",
                },
                "gujarati": {
                    "ભારતની રાજધાની": "ભારતની રાજધાની નવી દિલ્હી છે। આ દેશનું રાજકીય કેન્દ્ર છે અને અહીં સંસદ ભવન અને રાષ્ટ્રપતિ ભવન સ્થિત છે।",
                    "ફ્રાન્સની રાજધાની": "ફ્રાન્સની રાજધાની પેરિસ છે। આ સીન નદીના કિનારે વસેલું એક સુંદર શહેર છે।",
                },
                "hindi": {
                    "भारत की राजधानी": "भारत की राजधानी नई दिल्ली है। यह देश का राजनीतिक केंद्र है और यहाँ संसद भवन और राष्ट्रपति भवन स्थित हैं।",
                    "फ्रांस की राजधानी": "फ्रांस की राजधानी पेरिस है। यह सीन नदी के किनारे बसा एक खूबसूरत शहर है।",
                    "जापान की राजधानी": "जापान की राजधानी टोक्यो है। यह दुनिया के सबसे बड़े महानगरीय क्षेत्रों में से एक है।",
                    "अमेरिका की राजधानी": "अमेरिका की राजधानी वाशिंगटन डीसी है। यह पोटोमैक नदी के किनारे स्थित है।"
                },
                "kannada": {
                    "ಭಾರತದ ರಾಜಧಾನಿ": "ಭಾರತದ ರಾಜಧಾನಿ ನವ ದೆಹಲಿ. ಇದು ದೇಶದ ರಾಜಕೀಯ ಕೇಂದ್ರವಾಗಿದೆ ಮತ್ತು ಇಲ್ಲಿ ಸಂಸತ್ತು ಭವನ ಮತ್ತು ರಾಷ್ಟ್ರಪತಿ ಭವನ ಇದೆ.",
                    "ಫ್ರಾನ್ಸ್ ರಾಜಧಾನಿ": "ಫ್ರಾನ್ಸ್ ರಾಜಧಾನಿ ಪ್ಯಾರಿಸ್. ಇದು ಸೀನ್ ನದಿಯ ದಡದಲ್ಲಿರುವ ಸುಂದರ ನಗರ.",
                },
                "kashmiri": {
                    "ہندوستان ہُند راز دان": "ہندوستان ہُند راز دان نئی دِلی چھُ۔ یہ ملک ہُند سیاسی مرکز چھُ۔",
                },
                "maithili": {
                    "भारतक राजधानी": "भारतक राजधानी नव दिल्ली अछि। ई देशक राजनीतिक केन्द्र अछि आ एतय संसद भवन आ राष्ट्रपति भवन स्थित अछि।",
                },
                "malayalam": {
                    "ഇന്ത്യയുടെ തലസ്ഥാനം": "ഇന്ത്യയുടെ തലസ്ഥാനം ന്യൂഡൽഹിയാണ്. ഇത് രാജ്യത്തിന്റെ രാഷ്ട്രീയ കേന്ദ്രമാണ്, ഇവിടെ പാർലമെന്റ് ഭവനവും രാഷ്ട്രപതി ഭവനും സ്ഥിതി ചെയ്യുന്നു.",
                    "ഫ്രാൻസിന്റെ തലസ്ഥാനം": "ഫ്രാൻസിന്റെ തലസ്ഥാനം പാരീസ് ആണ്. സെയ്ൻ നദിയുടെ തീരത്തുള്ള മനോഹരമായ നഗരം.",
                },
                "marathi": {
                    "भारताची राजधानी": "भारताची राजधानी नवी दिल्ली आहे। हे देशाचे राजकीय केंद्र आहे आणि येथे संसद भवन आणि राष्ट्रपती भवन आहेत।",
                    "फ्रान्साची राजधानी": "फ्रान्साची राजधानी पॅरिस आहे। हे सीन नदीच्या काठावर वसलेले एक सुंदर शहर आहे।",
                    "जपानची राजधानी": "जपानची राजधानी टोक्यो आहे। हे जगातील सर्वात मोठ्या महानगरीय क्षेत्रांपैकी एक आहे।"
                },
                "meitei": {
                    "ভাৰতকী ৰাজধানী": "ভাৰতকী ৰাজধানী নিউ দিল্লী নি। মসি লৈবাক্কী পোলিটিকেল সেন্টৰ নি।",
                },
                "nepali": {
                    "भारतको राजधानी": "भारतको राजधानी नयाँ दिल्ली हो। यो देशको राजनीतिक केन्द्र हो र यहाँ संसद भवन र राष्ट्रपति भवन अवस्थित छन्।",
                    "फ्रान्सको राजधानी": "फ्रान्सको राजधानी पेरिस हो। यो सेन नदीको किनारमा रहेको एउटा सुन्दर शहर हो।",
                },
                "odia": {
                    "ଭାରତର ରାଜଧାନୀ": "ଭାରତର ରାଜଧାନୀ ନୂଆଦିଲ୍ଲୀ। ଏହା ଦେଶର ରାଜନୈତିକ କେନ୍ଦ୍ର ଏବଂ ଏଠାରେ ସଂସଦ ଭବନ ଓ ରାଷ୍ଟ୍ରପତି ଭବନ ଅବସ୍ଥିତ।",
                    "ଫ୍ରାନ୍ସର ରାଜଧାନୀ": "ଫ୍ରାନ୍ସର ରାଜଧାନୀ ପ୍ୟାରିସ୍। ଏହା ସେନ୍ ନଦୀ କୂଳରେ ଅବସ୍ଥିତ ଏକ ସୁନ୍ଦର ସହର।",
                },
                "punjabi": {
                    "ਭਾਰਤ ਦੀ ਰਾਜਧਾਨੀ": "ਭਾਰਤ ਦੀ ਰਾਜਧਾਨੀ ਨਵੀਂ ਦਿੱਲੀ ਹੈ। ਇਹ ਦੇਸ਼ ਦਾ ਰਾਜਨੀਤਿਕ ਕੇਂਦਰ ਹੈ ਅਤੇ ਇੱਥੇ ਸੰਸਦ ਭਵਨ ਅਤੇ ਰਾਸ਼ਟਰਪਤੀ ਭਵਨ ਸਥਿਤ ਹਨ।",
                    "ਫਰਾਂਸ ਦੀ ਰਾਜਧਾਨੀ": "ਫਰਾਂਸ ਦੀ ਰਾਜਧਾਨੀ ਪੈਰਿਸ ਹੈ। ਇਹ ਸੀਨ ਨਦੀ ਦੇ ਕਿਨਾਰੇ ਵਸਿਆ ਇੱਕ ਸੁੰਦਰ ਸ਼ਹਿਰ ਹੈ।",
                },
                "sanskrit": {
                    "भारतस्य राजधानी": "भारतस्य राजधानी नवदिल्ली अस्ति। एतत् राष्ट्रस्य राजनीतिकं केंद्रम् अस्ति।",
                    "फ्रांसस्य राजधानी": "फ्रांसस्य राजधानी पेरिस अस्ति। एतत् सीन नद्याः तटे स्थितम् सुन्दरं नगरम् अस्ति।",
                    "जापानस्य राजधानी": "जापानस्य राजधानी टोक्यो अस्ति। एतत् विश्वस्य महान् महानगरीयक्षेत्रेषु अन्यतमम् अस्ति।"
                },
                "santali": {
                    "भारत रेयाक् राजधानी": "भारत रेयाक् राजधानी नावा दिल्ली कानाय्। नोवा देस रेयाक् राजनीतिक केन्द्र कानाय्।",
                },
                "sindhi": {
                    "ڀارت جي گادي": "ڀارت جي گادي نئين دهلي آهي। هي ملڪ جو سياسي مرڪز آهي ۽ هتي پارليامينٽ هائوس ۽ صدر محل واقع آهن۔",
                },
                "tamil": {
                    "இந்தியாவின் தலைநகர்": "இந்தியாவின் தலைநகர் புது டெல்லி. இது நாட்டின் அரசியல் மையம் மற்றும் இங்கு பாராளுமன்றம் மற்றும் ராஷ்டிரபதி பவன் அமைந்துள்ளது.",
                    "பிரான்சின் தலைநகர்": "பிரான்சின் தலைநகர் பாரிஸ். இது செயின் நதிக்கரையில் அமைந்த அழகான நகரம்.",
                },
                "telugu": {
                    "భారతదేశ రాజధాని": "భారతదేశ రాజధాని న్యూఢిల్లీ. ఇది దేశం యొక్క రాజకీయ కేంద్రం మరియు ఇక్కడ పార్లమెంటు భవనం మరియు రాష్ట్రపతి భవనం ఉన్నాయి.",
                    "ఫ్రాన్స్ రాజధాని": "ఫ్రాన్స్ రాజధాని ప్యారిస్. ఇది సీన్ నది ఒడ్డున ఉన్న అందమైన నగరం.",
                },
                "urdu": {
                    "بھارت کا دارالحکومت": "بھارت کا دارالحکومت نئی دہلی ہے۔ یہ ملک کا سیاسی مرکز ہے اور یہاں پارلیمنٹ ہاؤس اور راشٹرپتی بھون واقع ہیں۔",
                    "فرانس کا دارالحکومت": "فرانس کا دارالحکومت پیرس ہے۔ یہ سین دریا کے کنارے واقع ایک خوبصورت شہر ہے۔",
                },
                "english": {
                    "capital of india": "The capital of India is New Delhi. It is the political center of the country and houses the Parliament House and Rashtrapati Bhavan.",
                    "capital of france": "The capital of France is Paris. It is a beautiful city located on the banks of the River Seine.",
                    "capital of japan": "The capital of Japan is Tokyo. It is one of the world's largest metropolitan areas.",
                    "capital of usa": "The capital of the United States is Washington D.C. It is located on the banks of the Potomac River."
                }
            },
            
            # Language and Linguistics
            "linguistics": {
                "assamese": {
                    "অসমীয়া ভাষা": "অসমীয়া অসমৰ মুখ্য ভাষা আৰু ভাৰতৰ অন্যতম সাংবিধানিক ভাষা। এই ভাষা বঙালী লিপিৰ সৈতে সম্পৰ্কিত।",
                    "টোকেনাইজেচন": "টোকেনাইজেচন হৈছে পাঠক সৰু সৰু টুকুৰা (টোকেন) কৰাৰ প্ৰক্ৰিয়া।",
                },
                "bengali": {
                    "বাংলা ভাষা": "বাংলা ভারত ও বাংলাদেশের প্রধান ভাষা। এটি বাংলা লিপিতে লেখা হয় এবং ইন্দো-ইউরোপীয় ভাষা পরিবারের অন্তর্গত।",
                    "টোকেনাইজেশন": "টোকেনাইজেশন হলো পাঠ্যকে ছোট ছোট অংশে (টোকেন) ভাগ করার প্রক্রিয়া।",
                },
                "bodo": {
                    "बड़ो भाषा": "बड़ो असामनि राजभाषा आरो भारतनि मान्यता प्राप्त भाषा। बे देवनागरी लिपिआव लिरजायो।",
                },
                "gujarati": {
                    "ગુજરાતી ભાષા": "ગુજરાતી ગુજરાત રાજ્યની મુખ્ય ભાષા છે અને ગુજરાતી લિપિમાં લખાય છે। આ ઇન્ડો-યુરોપિયન ભાષા પરિવારની ભાષા છે।",
                    "ટોકનાઇઝેશન": "ટોકનાઇઝેશન એટલે ટેક્સ્ટને નાના ભાગોમાં (ટોકન્સ) વિભાજિત કરવાની પ્રક્રિયા।",
                },
                "hindi": {
                    "हिंदी भाषा": "हिंदी भारत की राजभाषा है और देवनागरी लिपि में लिखी जाती है। यह भारत-यूरोपीय भाषा परिवार की भाषा है।",
                    "संस्कृत भाषा": "संस्कृत भारत की प्राचीनतम भाषा है। यह वेदों और पुराणों की भाषा है।",
                    "मराठी भाषा": "मराठी महाराष्ट्र राज्य की मुख्य भाषा है। यह देवनागरी लिपि में लिखी जाती है।",
                    "टोकनाइज़ेशन": "टोकनाइज़ेशन पाठ को छोटे-छोटे टुकड़ों (टोकन्स) में तोड़ने की प्रक्रिया है। यह प्राकृतिक भाषा प्रसंस्करण का एक महत्वपूर्ण चरण है।"
                },
                "kannada": {
                    "ಕನ್ನಡ ಭಾಷೆ": "ಕನ್ನಡ ಕರ್ನಾಟಕ ರಾಜ್ಯದ ಮುಖ್ಯ ಭಾಷೆ ಮತ್ತು ಕನ್ನಡ ಲಿಪಿಯಲ್ಲಿ ಬರೆಯಲಾಗುತ್ತದೆ। ಇದು ದ್ರಾವಿಡ ಭಾಷಾ ಕುಟುಂಬಕ್ಕೆ ಸೇರಿದೆ।",
                    "ಟೋಕನೈಸೇಶನ್": "ಟೋಕನೈಸೇಶನ್ ಎಂದರೆ ಪಠ್ಯವನ್ನು ಚಿಕ್ಕ ಭಾಗಗಳಾಗಿ (ಟೋಕನ್‌ಗಳು) ವಿಭಜಿಸುವ ಪ್ರಕ್ರಿಯೆ.",
                },
                "kashmiri": {
                    "کٲشُر زَبان": "کٲشُر جموں کشمیر ہُند راجبھاشا چھُ۔ یہ پرسو-عربی لپی مَنٛز لِکھنہ یِوان چھُ۔",
                },
                "maithili": {
                    "मैथिली भाषा": "मैथिली बिहार आ नेपालक मुख्य भाषा अछि। ई देवनागरी लिपि मे लिखल जाइत अछि।",
                    "टोकनाइजेशन": "टोकनाइजेशन पाठक छोट छोट टुकड़ा मे तोड़बाक प्रक्रिया अछि।",
                },
                "malayalam": {
                    "മലയാളം ഭാഷ": "മലയാളം കേരളത്തിന്റെ മുഖ്യ ഭാഷയാണ് മലയാളം ലിപിയിൽ എഴുതപ്പെടുന്നു. ഇത് ദ്രാവിഡ ഭാഷാ കുടുംബത്തിൽ പെടുന്നു.",
                    "ടോക്കണൈസേഷൻ": "ടോക്കണൈസേഷൻ എന്നാൽ ടെക്സ്റ്റിനെ ചെറിയ ഭാഗങ്ങളായി (ടോക്കണുകൾ) വിഭജിക്കുന്ന പ്രക്രിയ.",
                },
                "marathi": {
                    "हिंदी भाषा": "हिंदी ही भारताची राजभाषा आहे आणि ती देवनागरी लिपीत लिहिली जाते।",
                    "संस्कृत भाषा": "संस्कृत ही भारताची प्राचीनतम भाषा आहे। ही वेद आणि पुराणांची भाषा आहे।",
                    "मराठी भाषा": "मराठी ही महाराष्ट्र राज्याची मुख्य भाषा आहे। ही देवनागरी लिपीत लिहिली जाते।",
                    "टोकनाइझेशन": "टोकनाइझेशन म्हणजे मजकूराला लहान-लहान भागांमध्ये (टोकन्स) विभाजित करण्याची प्रक्रिया।"
                },
                "meitei": {
                    "মৈতৈলোন": "মৈতৈলোন মণিপুরগী মুখ্য ভাৱা নি আরো মৈতৈ লিপিদা ইবা য়াই।",
                },
                "nepali": {
                    "नेपाली भाषा": "नेपाली नेपालको राजभाषा हो र यो देवनागरी लिपिमा लेखिन्छ। यो भारत-युरोपेली भाषा परिवारको भाषा हो।",
                    "टोकनाइजेशन": "टोकनाइजेशन पाठलाई साना-साना टुक्रामा (टोकन्स) विभाजन गर्ने प्रक्रिया हो।",
                },
                "odia": {
                    "ଓଡ଼ିଆ ଭାଷା": "ଓଡ଼ିଆ ଓଡ଼ିଶା ରାଜ୍ୟର ମୁଖ୍ୟ ଭାଷା ଏବଂ ଓଡ଼ିଆ ଲିପିରେ ଲେଖାଯାଏ। ଏହା ଇଣ୍ଡୋ-ଆର୍ଯ୍ୟ ଭାଷା ପରିବାରର।",
                    "ଟୋକେନାଇଜେସନ": "ଟୋକେନାଇଜେସନ ହେଉଛି ପାଠକୁ ଛୋଟ ଛୋଟ ଅଂଶରେ (ଟୋକେନ) ବିଭାଜନ କରିବାର ପ୍ରକ୍ରିୟା।",
                },
                "punjabi": {
                    "ਪੰਜਾਬੀ ਭਾਸ਼ਾ": "ਪੰਜਾਬੀ ਪੰਜਾਬ ਰਾਜ ਦੀ ਮੁੱਖ ਭਾਸ਼ਾ ਹੈ ਅਤੇ ਗੁਰਮੁਖੀ ਲਿਪੀ ਵਿੱਚ ਲਿਖੀ ਜਾਂਦੀ ਹੈ। ਇਹ ਭਾਰਤ-ਯੂਰਪੀ ਭਾਸ਼ਾ ਪਰਿਵਾਰ ਦੀ ਭਾਸ਼ਾ ਹੈ।",
                    "ਟੋਕਨਾਈਜ਼ੇਸ਼ਨ": "ਟੋਕਨਾਈਜ਼ੇਸ਼ਨ ਟੈਕਸਟ ਨੂੰ ਛੋਟੇ ਭਾਗਾਂ (ਟੋਕਨਾਂ) ਵਿੱਚ ਤੋੜਨ ਦੀ ਪ੍ਰਕਿਰਿਆ ਹੈ।",
                },
                "sanskrit": {
                    "हिन्दी भाषा": "हिन्दी भारतस्य राजभाषा अस्ति। एषा देवनागरी लिप्यां लिख्यते।",
                    "संस्कृत भाषा": "संस्कृत भारतस्य प्राचीनतमा भाषा अस्ति। एषा वेदानां पुराणानां च भाषा अस्ति।",
                    "मराठी भाषा": "मराठी महाराष्ट्र राज्यस्य मुख्यभाषा अस्ति। एषा देवनागरी लिप्यां लिख्यते।"
                },
                "santali": {
                    "सान्ताली पाड़सी": "सान्ताली भारत रेयाक् आदिवासी पाड़सी कानाय्। नोवा ओल् चिकी लिपि रे ओलाकाना।",
                },
                "sindhi": {
                    "سنڌي ٻولي": "سنڌي سنڌ جي مکيه ٻولي آهي ۽ عربي-سنڌي رسم الخط ۾ لکيو ويندو آهي۔",
                },
                "tamil": {
                    "தமிழ் மொழி": "தமிழ் தமிழ்நாடு மற்றும் இலங்கையின் முக்கிய மொழி. இது தமிழ் எழுத்தில் எழுதப்படுகிறது மற்றும் திராவிட மொழி குடும்பத்தைச் சேர்ந்தது.",
                    "டோக்கனைசேஷன்": "டோக்கனைசேஷன் என்பது உரையை சிறிய பகுதிகளாக (டோக்கன்கள்) பிரிக்கும் செயல்முறை.",
                },
                "telugu": {
                    "తెలుగు భాష": "తెలుగు తెలంగాణ మరియు ఆంధ్ర ప్రదేశ్ రాష్ట్రాల ప్రధాన భాష. ఇది తెలుగు లిపిలో వ్రాయబడుతుంది మరియు ద్రావిడ భాషా కుటుంబానికి చెందినది.",
                    "టోకనైజేషన్": "టోకనైజేషన్ అనేది టెక్స్ట్‌ను చిన్న భాగాలుగా (టోకెన్లు) విభజించే ప్రక్రియ.",
                },
                "urdu": {
                    "اردو زبان": "اردو ہندوستان اور پاکستان کی اہم زبان ہے اور فارسی-عربی رسم الخط میں لکھی جاتی ہے۔ یہ ہند-یورپی زبانوں کے خاندان سے تعلق رکھتی ہے۔",
                    "ٹوکنائزیشن": "ٹوکنائزیشن متن کو چھوٹے حصوں (ٹوکنز) میں تقسیم کرنے کا عمل ہے۔",
                },
                "english": {
                    "hindi language": "Hindi is the official language of India and is written in the Devanagari script. It belongs to the Indo-European language family.",
                    "sanskrit language": "Sanskrit is the ancient language of India. It is the language of the Vedas and Puranas.",
                    "marathi language": "Marathi is the main language of Maharashtra state. It is written in the Devanagari script.",
                    "tokenization": "Tokenization is the process of breaking text into smaller units called tokens. It is a crucial step in natural language processing."
                }
            },
            
            # Cultural Information
            "culture": {
                "assamese": {
                    "ভাৰতীয় সংস্কৃতি": "ভাৰতীয় সংস্কৃতি বিশ্বৰ প্ৰাচীনতম সংস্কৃতিৰ ভিতৰত এটা। ইয়াত বৈচিত্ৰ্যৰ মাজত ঐক্যৰ নীতি নিহিত আছে।",
                    "বিহু উৎসৱ": "বিহু অসমৰ মুখ্য উৎসৱ। তিনি প্ৰকাৰৰ বিহু - ৰঙালী, ভোগালী আৰু কংগালী বিহু।",
                },
                "bengali": {
                    "ভারতীয় সংস্কৃতি": "ভারতীয় সংস্কৃতি বিশ্বের প্রাচীনতম সংস্কৃতিগুলির মধ্যে একটি। এতে বৈচিত্র্যে ঐক্যের নীতি নিহিত।",
                    "দুর্গা পূজা": "দুর্গা পূজা বাঙালিদের সবচেয়ে বড় উৎসব। এটি দেবী দুর্গার পূজা।",
                },
                "bodo": {
                    "भारतीय संस्कृति": "भारतीय संस्कृति दुनियानि आबुं प्राचीन संस्कृति फोरसा अन्जो। बे विविधताआव एकता दङ।",
                },
                "gujarati": {
                    "ભારતીય સંસ્કૃતિ": "ભારતીય સંસ્કૃતિ વિશ્વની સૌથી જૂની સંસ્કૃતિઓમાંની એક છે। તેમાં વિવિધતામાં એકતાનો સિદ્ધાંત સમાવિષ્ટ છે।",
                    "નવરાત્રી": "નવરાત્રી ગુજરાતમાં સૌથી મોટો તહેવાર છે। આ નવ રાત્રિ દરમિયાન ગરબા અને રાસ થાય છે।",
                },
                "hindi": {
                    "भारतीय संस्कृति": "भारतीय संस्कृति विश्व की सबसे पुरानी संस्कृतियों में से एक है। इसमें विविधता में एकता का सिद्धांत निहित है।",
                    "हिंदू धर्म": "हिंदू धर्म विश्व का सबसे पुराना धर्म है। इसमें वेद, उपनिषद और गीता जैसे पवित्र ग्रंथ हैं।",
                    "योग": "योग भारत की प्राचीन विद्या है जो शारीरिक, मानसिक और आध्यात्मिक कल्याण के लिए है।",
                    "भारतीय त्योहार": "भारत में दिवाली, होली, दशहरा, ईद, क्रिसमस जैसे कई त्योहार मनाए जाते हैं।"
                },
                "kannada": {
                    "ಭಾರತೀಯ ಸಂಸ್ಕೃತಿ": "ಭಾರತೀಯ ಸಂಸ್ಕೃತಿ ವಿಶ್ವದ ಅತ್ಯಂತ ಪ್ರಾಚೀನ ಸಂಸ್ಕೃತಿಗಳಲ್ಲಿ ಒಂದು. ಇದರಲ್ಲಿ ವೈವಿಧ್ಯತೆಯಲ್ಲಿ ಏಕತೆಯ ತತ್ವ ಅಡಗಿದೆ.",
                    "ಯೋಗ": "ಯೋಗ ಭಾರತದ ಪ್ರಾಚೀನ ವಿದ್ಯೆ ಶಾರೀರಿಕ, ಮಾನಸಿಕ ಮತ್ತು ಆಧ್ಯಾತ್ಮಿಕ ಯೋಗಕ್ಷೇಮಕ್ಕಾಗಿ.",
                },
                "kashmiri": {
                    "ہندوستٲنۍ کلچر": "ہندوستٲنۍ کلچر دنیاہُک سٮ۪تۍ پرون کلچراں منٛز اکھ چھُ۔",
                },
                "maithili": {
                    "भारतीय संस्कृति": "भारतीय संस्कृति दुनियाक सबसँ पुरान संस्कृति मे सँ एक अछि। एहि मे विविधता मे एकता अछि।",
                    "छठ पर्व": "छठ पर्व बिहारक सबसँ पैघ त्योहार अछि। ई सूर्य देवताक पूजा अछि।",
                },
                "malayalam": {
                    "ഇന്ത്യൻ സംസ്കാരം": "ഇന്ത്യൻ സംസ്കാരം ലോകത്തിലെ ഏറ്റവും പുരാതനമായ സംസ്കാരങ്ങളിൽ ഒന്നാണ്. ഇതിൽ വൈവിധ്യത്തിൽ ഐക്യം എന്ന തത്വം അന്തർലീനമാണ്.",
                    "ഓണം": "ഓണം കേരളത്തിന്റെ ഏറ്റവും വലിയ ഉത്സവമാണ്. ഇത് വിളവെടുപ്പ് ഉത്സവമാണ്.",
                },
                "marathi": {
                    "भारतीय संस्कृती": "भारतीय संस्कृती ही जगातील सर्वात जुनी संस्कृतींपैकी एक आहे। यात विविधतेत एकता हा तत्त्व आहे।",
                    "हिंदू धर्म": "हिंदू धर्म हा जगातील सर्वात जुना धर्म आहे। यात वेद, उपनिषदे आणि गीता यासारखे पवित्र ग्रंथ आहेत।",
                    "योग": "योग ही भारताची प्राचीन विद्या आहे जी शारीरिक, मानसिक आणि आध्यात्मिक कल्याणासाठी आहे।"
                },
                "meitei": {
                    "ভাৰতকী কল্চৰ": "ভাৰতকী কল্চৰ মাইবা পুন্নাগী অমনি। মসিদা বৈবিধ্য মঙাল পুন্সিন্নবগী মরম লৈ।",
                },
                "nepali": {
                    "भारतीय संस्कृति": "भारतीय संस्कृति विश्वको सबैभन्दा पुरानो संस्कृतिहरूमध्ये एक हो। यसमा विविधतामा एकताको सिद्धान्त निहित छ।",
                    "दशैं": "दशैं नेपालको सबैभन्दा ठूलो चाड हो। यो देवी दुर्गाको पूजा हो।",
                },
                "odia": {
                    "ଭାରତୀୟ ସଂସ୍କୃତି": "ଭାରତୀୟ ସଂସ୍କୃତି ବିଶ୍ୱର ପ୍ରାଚୀନତମ ସଂସ୍କୃତି ମଧ୍ୟରୁ ଗୋଟିଏ। ଏଥିରେ ବିବିଧତାରେ ଐକ୍ୟର ନୀତି ନିହିତ।",
                    "ରଥଯାତ୍ରା": "ରଥଯାତ୍ରା ଓଡ଼ିଶାର ସବୁଠାରୁ ବଡ ପର୍ବ। ଏହା ଜଗନ୍ନାଥଙ୍କ ରଥଯାତ୍ରା।",
                },
                "punjabi": {
                    "ਭਾਰਤੀ ਸੱਭਿਆਚਾਰ": "ਭਾਰਤੀ ਸੱਭਿਆਚਾਰ ਦੁਨੀਆ ਦੀਆਂ ਸਭ ਤੋਂ ਪੁਰਾਣੀਆਂ ਸੱਭਿਆਚਾਰਾਂ ਵਿੱਚੋਂ ਇੱਕ ਹੈ। ਇਸ ਵਿੱਚ ਵਿਭਿੰਨਤਾ ਵਿੱਚ ਏਕਤਾ ਦਾ ਸਿਧਾਂਤ ਹੈ।",
                    "ਵੈਸਾਖੀ": "ਵੈਸਾਖੀ ਪੰਜਾਬ ਦਾ ਸਭ ਤੋਂ ਵੱਡਾ ਤਿਉਹਾਰ ਹੈ। ਇਹ ਵਾਢੀ ਦਾ ਤਿਉਹਾਰ ਹੈ।",
                },
                "sanskrit": {
                    "भारतीय संस्कृतिः": "भारतीय संस्कृतिः विश्वस्य प्राचीनतमासु संस्कृतिषु अन्यतमा अस्ति।",
                    "हिन्दू धर्मः": "हिन्दू धर्मः विश्वस्य प्राचीनतमः धर्मः अस्ति। एतस्मिन् वेदाः, उपनिषदः, गीता च सन्ति।",
                    "योगः": "योगः भारतस्य प्राचीना विद्या अस्ति या शारीरिकं, मानसिकं, आध्यात्मिकं च कल्याणं करोति।"
                },
                "santali": {
                    "भारतीय संस्कृति": "भारतीय संस्कृति दुनिया रेयाक् आबुं प्राचीन संस्कृति कानाय्। नोवा रे विविधता रे एकता लेकान।",
                },
                "sindhi": {
                    "ڀارتي ثقافت": "ڀارتي ثقافت دنيا جي سڀکان پراڻي ثقافتن مان هڪ آهي۔ ان ۾ تنوع ۾ اتحاد جو اصول موجود آهي۔",
                },
                "tamil": {
                    "இந்திய பண்பாடு": "இந்திய பண்பாடு உலகின் மிகப் பழமையான பண்பாடுகளில் ஒன்று. இதில் பன்முகத்தன்மையில் ஒற்றுமை என்ற கொள்கை உள்ளது.",
                    "பொங்கல்": "பொங்கல் தமிழ்நாட்டின் மிகப்பெரிய பண்டிகை. இது அறுவடை திருநாள்.",
                },
                "telugu": {
                    "భారతీయ సంస్కృతి": "భారతీయ సంస్కృతి ప్రపంచంలోని అత్యంత పురాతన సంస్కృతులలో ఒకటి. ఇందులో వైవిధ్యంలో ఏకత్వం అనే సూత్రం అంతర్లీనంగా ఉంది.",
                    "ఉగాది": "ఉగాది తెలుగు వారి అతిపెద్ద పండుగ. ఇది తెలుగు నూతన సంవత్సరం.",
                },
                "urdu": {
                    "ہندوستانی تہذیب": "ہندوستانی تہذیب دنیا کی قدیم ترین تہذیبوں میں سے ایک ہے۔ اس میں تنوع میں اتحاد کا اصول موجود ہے۔",
                    "عید": "عید مسلمانوں کا سب سے بڑا تہوار ہے۔ عید الفطر اور عید الاضحی دو اہم تہوار ہیں۔",
                },
                "english": {
                    "indian culture": "Indian culture is one of the world's oldest cultures. It embodies the principle of unity in diversity.",
                    "hinduism": "Hinduism is the world's oldest religion. It includes sacred texts like the Vedas, Upanishads, and Bhagavad Gita.",
                    "yoga": "Yoga is India's ancient practice for physical, mental, and spiritual well-being.",
                    "indian festivals": "India celebrates many festivals including Diwali, Holi, Dussehra, Eid, and Christmas."
                }
            },
            
            # Technical NLP Knowledge
            "technical": {
                "assamese": {
                    "প্ৰাকৃতিক ভাষা প্ৰক্ৰিয়াকৰণ": "প্ৰাকৃতিক ভাষা প্ৰক্ৰিয়াকৰণ (এনএলপি) কম্পিউটাৰ আৰু মানৱ ভাষাৰ মাজত সংযোগৰ ক্ষেত্ৰ।",
                    "মেচিন লাৰ্নিং": "মেচিন লাৰ্নিং কম্পিউটাৰক স্পষ্ট প্ৰগ্ৰামিং অবিহনে শিকাৰ ক্ষমতা দিয়ে।",
                },
                "bengali": {
                    "প্রাকৃতিক ভাষা প্রক্রিয়াকরণ": "প্রাকৃতিক ভাষা প্রক্রিয়াকরণ (এনএলপি) কম্পিউটার এবং মানব ভাষার মধ্যে সংযোগের ক্ষেত্র।",
                    "মেশিন লার্নিং": "মেশিন লার্নিং কম্পিউটারকে স্পষ্ট প্রোগ্রামিং ছাড়াই শেখার ক্ষমতা দেয়।",
                },
                "bodo": {
                    "प्राकृतिक भाषा प्रसंस्करण": "प्राकृतिक भाषा प्रसंस्करण (एनएलपी) कम्प्युटार आरो मानव भाषानि मावथायनि क्षेत्र।",
                },
                "gujarati": {
                    "નેચરલ લેંગ્વેજ પ્રોસેસિંગ": "નેચરલ લેંગ્વેજ પ્રોસેસિંગ (એનએલપી) કમ્પ્યુટર અને માનવ ભાષા વચ્ચેનો સંપર્કનું ક્ષેત્ર છે।",
                    "મશીન લર્નિંગ": "મશીન લર્નિંગ કમ્પ્યુટરને સ્પષ્ટ પ્રોગ્રામિંગ વગર શીખવાની ક્ષમતા આપે છે।",
                },
                "hindi": {
                    "प्राकृतिक भाषा प्रसंस्करण": "प्राकृतिक भाषा प्रसंस्करण (एनएलपी) कंप्यूटर और मानव भाषा के बीच संपर्क का क्षेत्र है।",
                    "मशीन लर्निंग": "मशीन लर्निंग कंप्यूटर को बिना स्पष्ट प्रोग्रामिंग के सीखने की क्षमता देती है।",
                    "ट्रांसफॉर्मर मॉडल": "ट्रांसफॉर्मर मॉडल आधुनिक एनएलपी का आधार है, जो एटेंशन मैकेनिज्म का उपयोग करता है।",
                    "बहुभाषी मॉडल": "बहुभाषी मॉडल कई भाषाओं को समझ और उत्पन्न कर सकते हैं।"
                },
                "kannada": {
                    "ನೈಸರ್ಗಿಕ ಭಾಷಾ ಸಂಸ್ಕರಣೆ": "ನೈಸರ್ಗಿಕ ಭಾಷಾ ಸಂಸ್ಕರಣೆ (ಎನ್‌ಎಲ್‌ಪಿ) ಕಂಪ್ಯೂಟರ್ ಮತ್ತು ಮಾನವ ಭಾಷೆಯ ನಡುವಿನ ಸಂವಹನ ಕ್ಷೇತ್ರ.",
                    "ಮೆಷಿನ್ ಲರ್ನಿಂಗ್": "ಮೆಷಿನ್ ಲರ್ನಿಂಗ್ ಕಂಪ್ಯೂಟರ್‌ಗೆ ಸ್ಪಷ್ಟ ಪ್ರೋಗ್ರಾಮಿಂಗ್ ಇಲ್ಲದೆ ಕಲಿಯುವ ಸಾಮರ್ಥ್ಯ ನೀಡುತ್ತದೆ.",
                },
                "kashmiri": {
                    "نیچرل لینگوئج پروسسنگ": "نیچرل لینگوئج پروسسنگ (این ایل پی) کمپیوٹر تہ انسٲنی زبانَن درمیان رابطہ ہُند فیلڈ چھُ۔",
                },
                "maithili": {
                    "प्राकृतिक भाषा प्रसंस्करण": "प्राकृतिक भाषा प्रसंस्करण (एनएलपी) कम्प्युटर आ मानव भाषाक बीच संपर्कक क्षेत्र अछि।",
                    "मशीन लर्निंग": "मशीन लर्निंग कम्प्युटरके बिना स्पष्ट प्रोग्रामिंगक सिखबाक क्षमता दैत अछि।",
                },
                "malayalam": {
                    "നാച്വറൽ ലാംഗ്വേജ് പ്രോസസ്സിങ്": "നാച്വറൽ ലാംഗ്വേജ് പ്രോസസ്സിങ് (എൻഎൽപി) കമ്പ്യൂട്ടറും മനുഷ്യ ഭാഷയും തമ്മിലുള്ള ആശയവിനിമയ മേഖലയാണ്.",
                    "മെഷീൻ ലേണിംഗ്": "മെഷീൻ ലേണിംഗ് കമ്പ്യൂട്ടറിന് വ്യക്തമായ പ്രോഗ്രാമിംഗ് കൂടാതെ പഠിക്കാനുള്ള കഴിവ് നൽകുന്നു.",
                },
                "marathi": {
                    "नैसर्गिक भाषा प्रक्रिया": "नैसर्गिक भाषा प्रक्रिया (एनएलपी) हे संगणक आणि मानवी भाषा यांच्यातील संपर्काचे क्षेत्र आहे।",
                    "मशीन लर्निंग": "मशीन लर्निंग संगणकाला स्पष्ट प्रोग्रामिंगशिवाय शिकण्याची क्षमता देते।",
                    "ट्रान्सफॉर्मर मॉडेल": "ट्रान्सफॉर्मर मॉडेल हे आधुनिक एनएलपीचे आधार आहे, जे अटेंशन मेकॅनिझम वापरते।"
                },
                "meitei": {
                    "নেচরেল লেংগুৱেজ প্রসেসিং": "নেচরেল লেংগুৱেজ প্রসেসিং (এনএলপি) কমপিউটর অমসুং মীওইবগী লোল মরক্তা যোন্নবা ক্ষেত্রনি।",
                },
                "nepali": {
                    "प्राकृतिक भाषा प्रशोधन": "प्राकृतिक भाषा प्रशोधन (एनएलपी) कम्प्युटर र मानव भाषा बीचको सम्पर्कको क्षेत्र हो।",
                    "मेसिन लर्निङ": "मेसिन लर्निङले कम्प्युटरलाई स्पष्ट प्रोग्रामिङ बिना सिक्ने क्षमता दिन्छ।",
                },
                "odia": {
                    "ପ୍ରାକୃତିକ ଭାଷା ପ୍ରକ୍ରିୟାକରଣ": "ପ୍ରାକୃତିକ ଭାଷା ପ୍ରକ୍ରିୟାକରଣ (ଏନଏଲପି) କମ୍ପ୍ୟୁଟର ଏବଂ ମାନବ ଭାଷା ମଧ୍ୟରେ ସଂଯୋଗର କ୍ଷେତ୍ର।",
                    "ମେସିନ୍ ଲର୍ନିଂ": "ମେସିନ୍ ଲର୍ନିଂ କମ୍ପ୍ୟୁଟରକୁ ସ୍ପଷ୍ଟ ପ୍ରୋଗ୍ରାମିଂ ବିନା ଶିଖିବା କ୍ଷମତା ଦେଇଥାଏ।",
                },
                "punjabi": {
                    "ਕੁਦਰਤੀ ਭਾਸ਼ਾ ਪ੍ਰਕਿਰਿਆ": "ਕੁਦਰਤੀ ਭਾਸ਼ਾ ਪ੍ਰਕਿਰਿਆ (ਐਨਐਲਪੀ) ਕੰਪਿਊਟਰ ਅਤੇ ਮਨੁੱਖੀ ਭਾਸ਼ਾ ਵਿਚਕਾਰ ਸੰਪਰਕ ਦਾ ਖੇਤਰ ਹੈ।",
                    "ਮਸ਼ੀਨ ਲਰਨਿੰਗ": "ਮਸ਼ੀਨ ਲਰਨਿੰਗ ਕੰਪਿਊਟਰ ਨੂੰ ਸਪੱਸ਼ਟ ਪ੍ਰੋਗਰਾਮਿੰਗ ਤੋਂ ਬਿਨਾਂ ਸਿੱਖਣ ਦੀ ਸਮਰੱਥਾ ਦਿੰਦੀ ਹੈ।",
                },
                "sanskrit": {
                    "प्राकृतिक भाषा प्रसंस्करण": "प्राकृतिक भाषा प्रसंस्करणं कंप्यूटर मानवभाषयोः मध्ये सम्पर्कस्य क्षेत्रम् अस्ति।",
                    "मशीन लर्निंग": "मशीन लर्निंग कंप्यूटराय बिना स्पष्ट प्रोग्रामिंग सीखने क्षमता ददाति।"
                },
                "santali": {
                    "प्राकृतिक भाषा प्रसंस्करण": "प्राकृतिक भाषा प्रसंस्करण (एनएलपी) कम्प्युटार आरो मानव भाषा रेयाक् बाङ्गो कानाय्।",
                },
                "sindhi": {
                    "قدرتي ٻولي پروسيسنگ": "قدرتي ٻولي پروسيسنگ (اين ايل پي) ڪمپيوٽر ۽ انساني ٻولي وچ ان رابطي جو شعبو آهي۔",
                },
                "tamil": {
                    "இயற்கை மொழி செயலாக்கம்": "இயற்கை மொழி செயலாக்கம் (என்எல்பி) கணினி மற்றும் மனித மொழி இடையேயான தொடர்பு துறை.",
                    "இயந்திர கற்றல்": "இயந்திர கற்றல் கணினிக்கு வெளிப்படையான நிரலாக்கம் இல்லாமல் கற்கும் திறனை வழங்குகிறது.",
                },
                "telugu": {
                    "సహజ భాషా ప్రాసెసింగ్": "సహజ భాషా ప్రాసెసింగ్ (ఎన్ఎల్పి) కంప్యూటర్ మరియు మానవ భాష మధ్య పరస్పర చర్య యొక్క రంగం.",
                    "మెషిన్ లర్నింగ్": "మెషిన్ లర్నింగ్ కంప్యూటర్‌కు స్పష్టమైన ప్రోగ్రామింగ్ లేకుండా నేర్చుకునే సామర్థ్యాన్ని ఇస్తుంది.",
                },
                "urdu": {
                    "فطری زبان کی پروسیسنگ": "فطری زبان کی پروسیسنگ (این ایل پی) کمپیوٹر اور انسانی زبان کے درمیان رابطے کا شعبہ ہے۔",
                    "مشین لرننگ": "مشین لرننگ کمپیوٹر کو واضح پروگرامنگ کے بغیر سیکھنے کی صلاحیت دیتا ہے۔",
                },
                "english": {
                    "natural language processing": "Natural Language Processing (NLP) is the field of interaction between computers and human language.",
                    "machine learning": "Machine learning gives computers the ability to learn without being explicitly programmed.",
                    "transformer model": "Transformer models are the foundation of modern NLP, using attention mechanisms.",
                    "multilingual model": "Multilingual models can understand and generate text in multiple languages.",
                    "attention mechanism": "Attention mechanisms allow models to focus on relevant parts of input sequences.",
                    "fine-tuning": "Fine-tuning is the process of adapting a pre-trained model to a specific task or domain."
                }
            }
        }
    
    def search_knowledge(self, query: str, language: str, query_type: str) -> Dict[str, Any]:
        """Search the knowledge base for relevant information"""
        
        query_lower = query.lower()
        results = []
        
        # Search across different knowledge categories
        for category, lang_data in self.knowledge.items():
            if language in lang_data:
                for key, value in lang_data[language].items():
                    # Simple keyword matching
                    if any(word in query_lower for word in key.lower().split()):
                        results.append({
                            "answer": value,
                            "source": f"{category.title()} Knowledge Base",
                            "confidence": 0.9,
                            "category": category
                        })
        
        # If no specific match found, provide general responses
        if not results:
            results = self._get_general_response(query, language, query_type)
        
        return {
            "results": results,
            "total_found": len(results),
            "query_type": query_type,
            "language": language
        }
    
    def _get_general_response(self, query: str, language: str, query_type: str) -> List[Dict[str, Any]]:
        """Provide general responses when specific knowledge is not found"""
        
        general_responses = {
            "assamese": {
                "factual": f"মই আপোনাৰ প্ৰশ্ন '{query}' সম্পৰ্কে তথ্য বিচাৰি আছোঁ। এইটো এটা তথ্যভিত্তিক প্ৰশ্ন।",
                "educational": f"আপোনাৰ প্ৰশ্ন '{query}' শিক্ষামূলক। মই আপোনাক সহায় কৰিবলৈ ইয়াত আছোঁ।",
                "technical": f"এইটো এটা কাৰিকৰী প্ৰশ্ন: '{query}'। মই প্ৰাকৃতিক ভাষা প্ৰক্ৰিয়াকৰণত সহায় কৰিব পাৰোঁ।",
                "cultural": f"আপোনাৰ প্ৰশ্ন '{query}' সাংস্কৃতিক বিষয় সম্পৰ্কিত। ভাৰতীয় সংস্কৃতিৰ বিষয়ে সুধিব পাৰে।",
                "conversational": f"নমস্কাৰ! আপোনাৰ প্ৰশ্ন '{query}' সম্পৰ্কে কথা পাতি ভাল লাগিব।"
            },
            "bengali": {
                "factual": f"আমি আপনার প্রশ্ন '{query}' সম্পর্কে তথ্য খুঁজছি। এটি একটি তথ্যভিত্তিক প্রশ্ন।",
                "educational": f"আপনার প্রশ্ন '{query}' শিক্ষামূলক। আমি আপনাকে সাহায্য করার জন্য এখানে আছি।",
                "technical": f"এটি একটি প্রযুক্তিগত প্রশ্ন: '{query}'। আমি প্রাকৃতিক ভাষা প্রক্রিয়াকরণে সাহায্য করতে পারি।",
                "cultural": f"আপনার প্রশ্ন '{query}' সাংস্কৃতিক বিষয় সম্পর্কিত। ভারতীয় সংস্কৃতি সম্পর্কে জিজ্ঞাসা করতে পারেন।",
                "conversational": f"নমস্কার! আপনার প্রশ্ন '{query}' নিয়ে কথা বলতে ভালো লাগবে।"
            },
            "bodo": {
                "factual": f"आंनो नोंथांनि सुबुं '{query}' नि थाखाय महर खोन्दोंमोन। बेयो मोनसे तथ्य आधारित सुबुं।",
                "educational": f"नोंथांनि सुबुं '{query}' शिक्षामुलक। आं नोंथांखौ मदद खालामनो थागोन दङ।",
                "technical": f"बेयो मोनसे तकनीकी सुबुं: '{query}'। आं प्राकृतिक भाषा प्रसंस्करण नि थाखाय मदद खालामनो हागौ।",
                "cultural": f"नोंथांनि सुबुं '{query}' संस्कृति निफ्राय जेराव थोनाय। भारतीय संस्कृतिनि थाखाय नायथाखौ हागौ।",
                "conversational": f"आहो! नोंथांनि सुबुं '{query}' निफ्राय रावजों गासै गोनां जागोन।"
            },
            "gujarati": {
                "factual": f"હું તમારા પ્રશ્ન '{query}' વિશે માહિતી શોધી રહ્યો છું। આ એક તથ્યલક્ષી પ્રશ્ન છે।",
                "educational": f"તમારો પ્રશ્ન '{query}' શૈક્ષણિક સ્વરૂપનો છે। હું તમને મદદ કરવા માટે અહીં છું।",
                "technical": f"આ એક તકનીકી પ્રશ્ન છે: '{query}'। હું નેચરલ લેંગ્વેજ પ્રોસેસિંગમાં મદદ કરી શકું છું।",
                "cultural": f"તમારો પ્રશ્ન '{query}' સાંસ્કૃતિક વિષય સાથે સંબંધિત છે। ભારતીય સંસ્કૃતિ વિશે પૂછી શકો છો।",
                "conversational": f"નમસ્તે! તમારા પ્રશ્ન '{query}' વિશે વાત કરવાનું સારું લાગશે।"
            },
            "hindi": {
                "factual": f"मैं आपके प्रश्न '{query}' के बारे में जानकारी खोज रहा हूं। यह एक तथ्यात्मक प्रश्न है। अधिक विशिष्ट जानकारी के लिए कृपया अपना प्रश्न विस्तार से पूछें।",
                "educational": f"आपका प्रश्न '{query}' शैक्षिक प्रकृति का है। मैं आपकी सहायता करने के लिए यहां हूं।",
                "technical": f"यह एक तकनीकी प्रश्न है: '{query}'। मैं प्राकृतिक भाषा प्रसंस्करण और मशीन लर्निंग के क्षेत्र में सहायता कर सकता हूं।",
                "cultural": f"आपका प्रश्न '{query}' सांस्कृतिक विषय से संबंधित है। भारतीय संस्कृति और परंपराओं के बारे में पूछ सकते हैं।",
                "conversational": f"नमस्ते! आपके प्रश्न '{query}' के बारे में बात करना अच्छा लगेगा।"
            },
            "kannada": {
                "factual": f"ನಾನು ನಿಮ್ಮ ಪ್ರಶ್ನೆ '{query}' ಕುರಿತು ಮಾಹಿತಿ ಹುಡುಕುತ್ತಿದ್ದೇನೆ. ಇದು ಒಂದು ವಾಸ್ತವಿಕ ಪ್ರಶ್ನೆ.",
                "educational": f"ನಿಮ್ಮ ಪ್ರಶ್ನೆ '{query}' ಶೈಕ್ಷಣಿಕ ಸ್ವರೂಪದದು. ನಾನು ನಿಮಗೆ ಸಹಾಯ ಮಾಡಲು ಇಲ್ಲಿದ್ದೇನೆ.",
                "technical": f"ಇದು ಒಂದು ತಾಂತ್ರಿಕ ಪ್ರಶ್ನೆ: '{query}'. ನಾನು ನೈಸರ್ಗಿಕ ಭಾಷಾ ಸಂಸ್ಕರಣೆಯಲ್ಲಿ ಸಹಾಯ ಮಾಡಬಲ್ಲೆ.",
                "cultural": f"ನಿಮ್ಮ ಪ್ರಶ್ನೆ '{query}' ಸಾಂಸ್ಕೃತಿಕ ವಿಷಯಕ್ಕೆ ಸಂಬಂಧಿಸಿದೆ. ಭಾರತೀಯ ಸಂಸ್ಕೃತಿ ಬಗ್ಗೆ ಕೇಳಬಹುದು.",
                "conversational": f"ನಮಸ್ಕಾರ! ನಿಮ್ಮ ಪ್ರಶ್ನೆ '{query}' ಬಗ್ಗೆ ಮಾತನಾಡಲು ಖುಷಿಯಾಗುತ್ತದೆ."
            },
            "kashmiri": {
                "factual": f"بہ چھُس تُہندِس سوال '{query}' متعلق معلومات تلاش کران۔ یہ اکھ حقیقت پر مبنی سوال چھُ۔",
                "educational": f"تُہُند سوال '{query}' چھُ تعلیمی نوعیتُک۔ بہ چھُس تُہند مدد کرنہ باپت یتہ۔",
                "technical": f"یہ چھُ اکھ تکنیکی سوال: '{query}'۔ بہ چھُس قدرتی زبان پروسیسنگ منٛز مدد کٔرتھ ہیکان۔",
                "cultural": f"تُہُند سوال '{query}' چھُ ثقافتی موضوع سان تعلق تھاوان۔",
                "conversational": f"نمستے! تُہند سوال '{query}' متعلق گفتگو کرُن خوشی گژھ۔"
            },
            "maithili": {
                "factual": f"हम अहाँक प्रश्न '{query}' केर बारे मे जानकारी खोजि रहल छी। ई एकटा तथ्यात्मक प्रश्न अछि।",
                "educational": f"अहाँक प्रश्न '{query}' शैक्षिक प्रकृतिक अछि। हम अहाँक सहायता करबाक लेल एतय छी।",
                "technical": f"ई एकटा तकनीकी प्रश्न अछि: '{query}'। हम प्राकृतिक भाषा प्रसंस्करण मे सहायता कऽ सकैत छी।",
                "cultural": f"अहाँक प्रश्न '{query}' सांस्कृतिक विषय सँ संबंधित अछि।",
                "conversational": f"नमस्कार! अहाँक प्रश्न '{query}' केर बारे मे गप करब नीक लागत।"
            },
            "malayalam": {
                "factual": f"ഞാൻ നിങ്ങളുടെ ചോദ്യം '{query}' സംബന്ധിച്ച വിവരങ്ങൾ തിരയുകയാണ്. ഇതൊരു വസ്തുതാപരമായ ചോദ്യമാണ്.",
                "educational": f"നിങ്ങളുടെ ചോദ്യം '{query}' വിദ്യാഭ്യാസപരമാണ്. നിങ്ങളെ സഹായിക്കാൻ ഞാൻ ഇവിടെയുണ്ട്.",
                "technical": f"ഇതൊരു സാങ്കേതിക ചോദ്യമാണ്: '{query}'. എനിക്ക് നാച്വറൽ ലാംഗ്വേജ് പ്രോസസ്സിങ്ങിൽ സഹായിക്കാം.",
                "cultural": f"നിങ്ങളുടെ ചോദ്യം '{query}' സാംസ്കാരിക വിഷയവുമായി ബന്ധപ്പെട്ടതാണ്.",
                "conversational": f"നമസ്കാരം! നിങ്ങളുടെ ചോദ്യം '{query}' സംബന്ധിച്ച് സംസാരിക്കാൻ സന്തോഷമുണ്ട്."
            },
            "marathi": {
                "factual": f"मी तुमच्या प्रश्नाबद्दल '{query}' माहिती शोधत आहे। हा एक तथ्यात्मक प्रश्न आहे।",
                "educational": f"तुमचा प्रश्न '{query}' शैक्षणिक स्वरूपाचा आहे। मी तुमची मदत करण्यासाठी येथे आहे।",
                "technical": f"हा एक तांत्रिक प्रश्न आहे: '{query}'। मी नैसर्गिक भाषा प्रक्रिया आणि मशीन लर्निंगच्या क्षेत्रात मदत करू शकतो।",
                "cultural": f"तुमचा प्रश्न '{query}' सांस्कृतिक विषयाशी संबंधित आहे। भारतीय संस्कृती आणि परंपरांबद्दल विचारू शकता।",
                "conversational": f"नमस्कार! तुमच्या प्रश्नाबद्दल '{query}' बोलणे छान वाटेल।"
            },
            "meitei": {
                "factual": f"ঐনা নঙ্গী ৱাহঙ '{query}' মরমদা মফম থীরি। মসি অমা ফ্যাক্ট বেসদ ৱাহঙনি।",
                "educational": f"নঙ্গী ৱাহঙ '{query}' এদুকেসনেল মতমনি। ঐনা নঙ্গবু মতেং পাংবা মফম অসিদা লৈ।",
                "technical": f"মসি অমা টেকনিকেল ৱাহঙনি: '{query}'। ঐনা নেচরেল লেংগুৱেজ প্রসেসিং দা মতেং পাংবা য়াই।",
                "cultural": f"নঙ্গী ৱাহঙ '{query}' কল্চরেল বিষয় মরিলনি।",
                "conversational": f"খুরুম্জরি! নঙ্গী ৱাহঙ '{query}' মতাং দা ৱারি শাবা ফংগনি।"
            },
            "nepali": {
                "factual": f"म तपाईंको प्रश्न '{query}' को बारेमा जानकारी खोज्दै छु। यो एक तथ्यात्मक प्रश्न हो।",
                "educational": f"तपाईंको प्रश्न '{query}' शैक्षिक प्रकृतिको छ। म तपाईंलाई मद्दत गर्न यहाँ छु।",
                "technical": f"यो एक प्राविधिक प्रश्न हो: '{query}'। म प्राकृतिक भाषा प्रशोधनमा मद्दत गर्न सक्छु।",
                "cultural": f"तपाईंको प्रश्न '{query}' सांस्कृतिक विषयसँग सम्बन्धित छ।",
                "conversational": f"नमस्ते! तपाईंको प्रश्न '{query}' बारे कुरा गर्न राम्रो लाग्नेछ।"
            },
            "odia": {
                "factual": f"ମୁଁ ଆପଣଙ୍କ ପ୍ରଶ୍ନ '{query}' ବିଷୟରେ ସୂଚନା ଖୋଜୁଛି। ଏହା ଏକ ତଥ୍ୟାତ୍ମକ ପ୍ରଶ୍ନ।",
                "educational": f"ଆପଣଙ୍କ ପ୍ରଶ୍ନ '{query}' ଶିକ୍ଷଣୀୟ। ମୁଁ ଆପଣଙ୍କୁ ସାହାଯ୍ୟ କରିବାକୁ ଏଠାରେ ଅଛି।",
                "technical": f"ଏହା ଏକ ଯାନ୍ତ୍ରିକ ପ୍ରଶ୍ନ: '{query}'। ମୁଁ ପ୍ରାକୃତିକ ଭାଷା ପ୍ରକ୍ରିୟାକରଣରେ ସାହାଯ୍ୟ କରିପାରିବି।",
                "cultural": f"ଆପଣଙ୍କ ପ୍ରଶ୍ନ '{query}' ସାଂସ୍କୃତିକ ବିଷୟ ସହ ସମ୍ବନ୍ଧିତ।",
                "conversational": f"ନମସ୍କାର! ଆପଣଙ୍କ ପ୍ରଶ୍ନ '{query}' ବିଷୟରେ କଥା ହେବା ଭଲ ଲାଗିବ।"
            },
            "punjabi": {
                "factual": f"ਮੈਂ ਤੁਹਾਡੇ ਸਵਾਲ '{query}' ਬਾਰੇ ਜਾਣਕਾਰੀ ਖੋਜ ਰਿਹਾ ਹਾਂ। ਇਹ ਇੱਕ ਤੱਥਾਤਮਕ ਸਵਾਲ ਹੈ।",
                "educational": f"ਤੁਹਾਡਾ ਸਵਾਲ '{query}' ਵਿਦਿਅਕ ਪ੍ਰਕਿਰਤੀ ਦਾ ਹੈ। ਮੈਂ ਤੁਹਾਡੀ ਮਦਦ ਕਰਨ ਲਈ ਇੱਥੇ ਹਾਂ।",
                "technical": f"ਇਹ ਇੱਕ ਤਕਨੀਕੀ ਸਵਾਲ ਹੈ: '{query}'। ਮੈਂ ਕੁਦਰਤੀ ਭਾਸ਼ਾ ਪ੍ਰਕਿਰਿਆ ਵਿੱਚ ਮਦਦ ਕਰ ਸਕਦਾ ਹਾਂ।",
                "cultural": f"ਤੁਹਾਡਾ ਸਵਾਲ '{query}' ਸੱਭਿਆਚਾਰਕ ਵਿਸ਼ੇ ਨਾਲ ਸਬੰਧਿਤ ਹੈ।",
                "conversational": f"ਸਤ ਸ੍ਰੀ ਅਕਾਲ! ਤੁਹਾਡੇ ਸਵਾਲ '{query}' ਬਾਰੇ ਗੱਲ ਕਰਨਾ ਚੰਗਾ ਲੱਗੇਗਾ।"
            },
            "sanskrit": {
                "factual": f"अहं भवतः प्रश्नस्य '{query}' विषये सूचनां अन्विष्यामि। एषा तथ्यात्मिका प्रश्ना अस्ति।",
                "educational": f"भवतः प्रश्नः '{query}' शैक्षिकः अस्ति। अहं भवतः सहायतार्थं अत्र अस्मि।",
                "technical": f"एषा तकनीकी प्रश्ना अस्ति: '{query}'। अहं प्राकृतिक भाषा प्रसंस्करण विषये सहायतां कर्तुं शक्नोमि।",
                "cultural": f"भवतः प्रश्नः '{query}' सांस्कृतिक विषये संबंधितः अस्ति। भारतीय संस्कृतेः विषये पृच्छतु।",
                "conversational": f"नमस्कारः! भवतः प्रश्नेन '{query}' सह वार्तालापः रोचकः भविष्यति।"
            },
            "santali": {
                "factual": f"आं नोंथाङ्क सुबुङ् '{query}' रेयाक् बाबोत रे महोर खोन्दोङ कानाय्ङ्। नोवा मोनसे तथ्य आधारित सुबुङ् कानाय्।",
                "educational": f"नोंथाङ्क सुबुङ् '{query}' शिक्षा रे सम्बन्धित मेनाक्। आं नोंथाङ्ऽ मदद खालामनो थाङ्गाइत् कानाय्ङ्।",
                "technical": f"नोवा मोनसे तकनीकी सुबुङ् कानाय्: '{query}'। आं प्राकृतिक भाषा प्रसंस्करण रे मदद दाड़ेयाक्ङ्आ।",
                "cultural": f"नोंथाङ्क सुबुङ् '{query}' संस्कृति निफ्राय लगाव मेनाक्।",
                "conversational": f"जोहार! नोंथाङ्क सुबुङ् '{query}' बाबोत रे रोड़ोक् रोड़ाङ् नोमोस्कार।"
            },
            "sindhi": {
                "factual": f"مان توهان جي سوال '{query}' بابت معلومات ڳولي رهيو آهيان۔ هي هڪ حقيقت تي ٻڌل سوال آهي۔",
                "educational": f"توهان جو سوال '{query}' تعليمي نوعيت جو آهي۔ مان توهان جي مدد ڪرڻ لاءِ هتي آهيان۔",
                "technical": f"هي هڪ ٽيڪنيڪل سوال آهي: '{query}'۔ مان قدرتي ٻولي پروسيسنگ ۾ مدد ڪري سگهان ٿو۔",
                "cultural": f"توهان جو سوال '{query}' ثقافتي موضوع سان تعلق رکي ٿو۔",
                "conversational": f"السلام عليڪم! توهان جي سوال '{query}' بابت ڳالهائڻ سٺو لڳندو۔"
            },
            "tamil": {
                "factual": f"நான் உங்கள் கேள்வி '{query}' பற்றி தகவல் தேடுகிறேன். இது ஒரு உண்மை சார்ந்த கேள்வி.",
                "educational": f"உங்கள் கேள்வி '{query}' கல்வி சார்ந்தது. உங்களுக்கு உதவ நான் இங்கே இருக்கிறேன்.",
                "technical": f"இது ஒரு தொழில்நுட்ப கேள்வி: '{query}'. நான் இயற்கை மொழி செயலாக்கத்தில் உதவ முடியும்.",
                "cultural": f"உங்கள் கேள்வி '{query}' கலாச்சார விஷயத்துடன் தொடர்புடையது.",
                "conversational": f"வணக்கம்! உங்கள் கேள்வி '{query}' பற்றி பேசுவது மகிழ்ச்சியாக இருக்கும்."
            },
            "telugu": {
                "factual": f"నేను మీ ప్రశ్న '{query}' గురించి సమాచారం వెతుకుతున్నాను. ఇది వాస్తవిక ప్రశ్న.",
                "educational": f"మీ ప్రశ్న '{query}' విద్యాపరమైనది. మీకు సహాయం చేయడానికి నేను ఇక్కడ ఉన్నాను.",
                "technical": f"ఇది సాంకేతిక ప్రశ్న: '{query}'. నేను సహజ భాషా ప్రాసెసింగ్‌లో సహాయం చేయగలను.",
                "cultural": f"మీ ప్రశ్న '{query}' సాంస్కృతిక విషయానికి సంబంధించినది.",
                "conversational": f"నమస్తే! మీ ప్రశ్న '{query}' గురించి మాట్లాడటం సంతోషంగా ఉంటుంది."
            },
            "urdu": {
                "factual": f"میں آپ کے سوال '{query}' کے بارے میں معلومات تلاش کر رہا ہوں۔ یہ ایک حقیقت پر مبنی سوال ہے۔",
                "educational": f"آپ کا سوال '{query}' تعلیمی نوعیت کا ہے۔ میں آپ کی مدد کرنے کے لیے یہاں ہوں۔",
                "technical": f"یہ ایک تکنیکی سوال ہے: '{query}'۔ میں فطری زبان کی پروسیسنگ میں مدد کر سکتا ہوں۔",
                "cultural": f"آپ کا سوال '{query}' ثقافتی موضوع سے متعلق ہے۔",
                "conversational": f"السلام علیکم! آپ کے سوال '{query}' کے بارے میں بات کرنا اچھا لگے گا۔"
            },
            "english": {
                "factual": f"I'm searching for information about '{query}'. This appears to be a factual question. For more specific information, please ask your question in more detail.",
                "educational": f"Your question '{query}' is educational in nature. I'm here to help you learn.",
                "technical": f"This is a technical question: '{query}'. I can help with natural language processing and machine learning topics.",
                "cultural": f"Your question '{query}' is related to cultural topics. You can ask about Indian culture and traditions.",
                "conversational": f"Hello! I'd be happy to discuss '{query}' with you."
            }
        }
        
        response_text = general_responses.get(language, general_responses["english"]).get(query_type, general_responses["english"]["factual"])
        
        return [{
            "answer": response_text,
            "source": "General Knowledge Base",
            "confidence": 0.7,
            "category": "general"
        }]

# Initialize the knowledge base
kb = KnowledgeBase()

# Create FastAPI app
app = FastAPI(
    title="Multilingual Knowledge Base API",
    description="Custom KB service for multilingual tokenization system",
    version="1.0.0"
)

@app.post("/multilingual-conversation", response_model=KBResponse)
async def multilingual_conversation(request: KBRequest):
    """Main KB endpoint for multilingual conversations"""
    
    start_time = time.time()
    
    try:
        # Classify query type
        query_type = _classify_query_type(request.text)
        
        # Search knowledge base
        search_results = kb.search_knowledge(request.text, request.language, query_type)
        
        # Get the best answer
        best_answer = search_results["results"][0] if search_results["results"] else None
        
        if best_answer:
            kb_answer = best_answer["answer"]
            confidence = best_answer["confidence"]
            sources = [best_answer["source"]]
        else:
            kb_answer = "I apologize, but I don't have specific information about that topic."
            confidence = 0.3
            sources = ["General Knowledge Base"]
        
        # Generate enhanced response if requested
        generated_response = None
        if request.generate_response:
            generated_response = _enhance_response(kb_answer, request.text, request.language)
        
        processing_time = time.time() - start_time
        
        return KBResponse(
            answer=generated_response or kb_answer,
            confidence=confidence,
            sources=sources,
            language=request.language,
            query_type=query_type,
            processing_time=processing_time,
            kb_answer=kb_answer,
            generated_response=generated_response,
            metadata={
                "total_results": search_results["total_found"],
                "kb_confidence": confidence,
                "kb_sources": sources
            }
        )
        
    except Exception as e:
        logger.error(f"KB service error: {e}")
        raise HTTPException(status_code=500, detail=f"KB service error: {e}")

def _classify_query_type(text: str) -> str:
    """Classify the query type based on content"""
    
    text_lower = text.lower()
    
    # Technical keywords
    if any(word in text_lower for word in ["api", "code", "programming", "technical", "model", "token", "python", "javascript", "nlp", "machine learning"]):
        return "technical"
    
    # Educational keywords
    if any(word in text_lower for word in ["explain", "teach", "learn", "study", "definition", "what is", "how does"]):
        return "educational"
    
    # Cultural keywords
    if any(word in text_lower for word in ["tradition", "festival", "culture", "history", "religion", "yoga", "hindu", "indian"]):
        return "cultural"
    
    # Geography keywords
    if any(word in text_lower for word in ["capital", "country", "city", "india", "france", "japan", "usa"]):
        return "factual"
    
    # Greeting keywords
    if any(word in text_lower for word in ["hello", "hi", "namaste", "नमस्ते", "नमस्कार"]):
        return "conversational"
    
    return "factual"  # Default

def _enhance_response(base_answer: str, original_query: str, language: str) -> str:
    """Enhance the response with additional context"""
    
    # Language-specific knowledge base notes
    kb_notes = {
        "assamese": "(এই তথ্য আমাৰ জ্ঞান ভিত্তিৰ পৰা প্ৰাপ্ত কৰা হৈছে।)",
        "bengali": "(এই তথ্য আমাদের জ্ঞান ভিত্তি থেকে প্রাপ্ত করা হয়েছে।)",
        "bodo": "(बे महर आं जानकारी भान्दार निफ्राय मोनांगो।)",
        "gujarati": "(આ માહિતી અમારા જ્ઞાન આધારમાંથી મેળવવામાં આવી છે।)",
        "hindi": "(यह जानकारी हमारे ज्ञान आधार से प्राप्त की गई है।)",
        "kannada": "(ಈ ಮಾಹಿತಿಯನ್ನು ನಮ್ಮ ಜ್ಞಾನ ನೆಲೆಯಿಂದ ಪಡೆಯಲಾಗಿದೆ.)",
        "kashmiri": "(یہ معلومات أسۍ ہنٛدس علم بیس پیٹھ حٲصل کرنہ آمت چھُ۔)",
        "maithili": "(ई जानकारी हमरा ज्ञान आधार सँ प्राप्त कयल गेल अछि।)",
        "malayalam": "(ഈ വിവരങ്ങൾ ഞങ്ങളുടെ അറിവ് അടിത്തറയിൽ നിന്നും ലഭിച്ചതാണ്.)",
        "marathi": "(ही माहिती आमच्या ज्ञान आधारावरून मिळाली आहे।)",
        "meitei": "(মফম অসি ঐখোয়গী নওলেজ বেসদগী ফংখ্রে।)",
        "nepali": "(यो जानकारी हाम्रो ज्ञान आधारबाट प्राप्त गरिएको हो।)",
        "odia": "(ଏହି ସୂଚନା ଆମର ଜ୍ଞାନ ଭିତ୍ତିରୁ ପ୍ରାପ୍ତ କରାଯାଇଛି।)",
        "punjabi": "(ਇਹ ਜਾਣਕਾਰੀ ਸਾਡੇ ਗਿਆਨ ਆਧਾਰ ਤੋਂ ਪ੍ਰਾਪਤ ਕੀਤੀ ਗਈ ਹੈ।)",
        "sanskrit": "(एषा सूचना अस्माकं ज्ञान आधारात् प्राप्ता।)",
        "santali": "(नोवा महोर आलेक् जानकारी भान्दार रे मोनाक्ना।)",
        "sindhi": "(هيء معلومات اسان جي علمي بنياد مان حاصل ڪئي وئي آهي۔)",
        "tamil": "(இந்த தகவல் எங்கள் அறிவுத் தளத்திலிருந்து பெறப்பட்டது.)",
        "telugu": "(ఈ సమాచారం మా జ్ఞాన స్థావరం నుండి పొందబడింది.)",
        "urdu": "(یہ معلومات ہمارے علمی بنیاد سے حاصل کی گئی ہیں۔)",
        "english": "(This information was retrieved from our knowledge base.)"
    }
    
    note = kb_notes.get(language, kb_notes["english"])
    return f"{base_answer}\n\n{note}"

@app.get("/health")
async def health_check():
    """Health check endpoint"""
    return {"status": "healthy", "service": "multilingual-kb", "version": "1.0.0"}

@app.get("/stats")
async def get_stats():
    """Get KB service statistics"""
    return {
        "knowledge_base": {
            "total_categories": len(kb.knowledge),
            "supported_languages": [
                "assamese", "bengali", "bodo", "english", "gujarati", "hindi", 
                "kannada", "kashmiri", "maithili", "malayalam", "marathi", 
                "meitei", "nepali", "odia", "punjabi", "sanskrit", "santali", 
                "sindhi", "tamil", "telugu", "urdu"
            ],
            "total_entries": sum(len(lang_data) for category in kb.knowledge.values() for lang_data in category.values())
        },
        "service_stats": kb.stats
    }

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="127.0.0.1", port=8001)
